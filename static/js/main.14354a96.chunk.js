(this["webpackJsonpchat-ui"]=this["webpackJsonpchat-ui"]||[]).push([[0],{34:function(e,t,a){e.exports=a(72)},39:function(e,t,a){},40:function(e,t,a){},69:function(e,t){},72:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(31),s=a.n(r),c=(a(39),a(8)),l=a(33),i=a(4),u=(a(40),a(32)),m=a.n(u)()("https://robchat-fullstack.herokuapp.com");var f=function(){var e="Rob-"+Math.round(100*Math.random()),t=Object(n.useState)([{title:"Room 1",history:[{msg:"Hello Irina",user:"Rob"},{msg:"Hey Rob",user:"Irina"}],users:["Rob","Irina"]},{title:"Room 2",history:[{msg:"Hello to issue channel",user:"Admin"}],users:["Admin"]}]),a=Object(i.a)(t,2),r=a[0],s=a[1],u=Object(n.useState)(),f=Object(i.a)(u,2),d=f[0],v=f[1],h=Object(n.useState)(),g=Object(i.a)(h,2),p=g[0],E=g[1],b=Object(n.useState)(""),j=Object(i.a)(b,2),O=j[0],y=j[1],R=Object(n.useRef)(),k=Object(n.useRef)(),N=Object(n.useRef)(),C=Object(n.useRef)(),w=function(){d&&(console.log("Leaving room: ",d.title),m.emit("leaveRoom",{room:d.title,user:k.current.value}),v())};return Object(n.useEffect)((function(){console.log("Rooms changed: ",r),function(){if(d){var e=k.current.value,t=d.users.filter((function(t){return t.name!=e}));t.unshift({name:"To everyone",socketId:""}),console.log("Other users: ",t),E(t)}}()}),[r]),Object(n.useEffect)((function(){return m.on("getRooms",(function(e){s(e)})),m.emit("getRooms"),function(){w()}}),[]),Object(n.useEffect)((function(){console.log("Active Room changed: ",d);["message","userList","removeUser"].forEach((function(e){m.hasListeners(e)&&m.removeEventListener(e)})),m.on("message",(function(e){console.log("Yay! Message received: ",e),function(e){var t=Object(c.a)(r),a=t.find((function(t){return t.title==e.room}));a&&(a.history.push(e),s(t))}(e),C.current.scrollTop=C.current.scrollHeight})),m.on("userList",(function(e){var t=e.room,a=e.users;console.log("Users updated: ",t,a),a&&0===a.length?w():function(e,t){var a=Object(c.a)(r),n=a.find((function(t){return t.title==e}));n&&(n.users=t),console.log("Updated users:",n.users),s(a)}(t,a)})),m.on("removeUser",(function(e){var t=e.room,a=e.user;console.log("removeUser: ",t,a),function(e,t){var a=Object(c.a)(r),n=a.find((function(t){return t.title==e}));n&&(n.users=n.users.filter((function(e){return e.name!=t}))),console.log("Updated users after removal:",n.users),s(a)}(t,a)}))}),[d]),o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("p",null,"Chat-App")),o.a.createElement("main",null,o.a.createElement("div",{className:"chat"},o.a.createElement("div",{className:"chat-rooms"},o.a.createElement("div",{className:"chat-rooms-title"},"Rooms"),o.a.createElement("ul",null,r.map((function(e){return o.a.createElement("li",{className:d&&e.title==d.title?"active-room-li":"",key:e.title,onClick:function(t){return function(e){var t=k.current.value;d&&e.title==d.title||(t?(d&&w(),v(e),console.log("Switched room to ".concat(e.title)),m.emit("joinRoom",{room:e.title,user:t}),y("")):(console.log("Please provide a user name before joining"),y("Please provide a user name before joining")))}(e)}},e.title)}))),d&&o.a.createElement("div",null,o.a.createElement("button",{onClick:w},"Leave ".concat(d.title)))),o.a.createElement("div",{className:"chat-history"},o.a.createElement("div",{className:"active-room-title"},d?d.title:"(no room active)"),o.a.createElement("textarea",{autoComplete:"off",placeholder:"Chat messages...",readOnly:!0,ref:C,value:d?d.history.map((function(e){return function(e){var t=e.user;e.direct&&(t+=" (private to "+(k.current.value===e.userToName?"you":e.userToName)+")");return t+=": "+e.msg}(e)})).join("\n"):""}),o.a.createElement("div",{className:"chat-message"},o.a.createElement("input",{placeholder:"Username...",autoComplete:"off",type:"text",id:"user",defaultValue:e,ref:k}),d&&o.a.createElement(o.a.Fragment,null,o.a.createElement("select",{ref:N,onChange:function(e){return e}},p&&p.map((function(e){return o.a.createElement("option",{value:e.socketId},e.name)}))),o.a.createElement("input",{placeholder:"Write your message here...",autoComplete:"off",type:"text",id:"message",ref:R}),o.a.createElement("button",{onClick:function(){var e=R.current.value,t=k.current.value,a=N.current.value,n=N.current.selectedIndex,o=N.current.options[n].text;if(d)if(e&&t){var r={msg:e,user:t,room:d.title};a&&(r=Object(l.a)({},r,{userToId:a,userToName:o})),console.log("Sending ".concat(a?"(private)":"",": "),r),m.emit("message",r),y(""),R.current.value=""}else console.log("Please provide username & message"),y("Please provide username & message");else console.log("Please join a room first - and state a username"),y("Please join a room first - and state a username")}},"Send")))),o.a.createElement("div",{className:"chat-users"},o.a.createElement("div",{className:"chat-users-title"},"Users"),o.a.createElement("ul",null,d&&d.users.map((function(e){return o.a.createElement("li",{key:e.name},e.name)}))),d&&o.a.createElement("div",{className:"chat-users-kickout"},o.a.createElement("button",{onClick:function(){d&&(console.log("Clearing room: ",d.title),m.emit("clearRoom",d.title))}},"Kick out all users"))))),o.a.createElement("div",{className:"errors"},O),o.a.createElement("footer",null,"\xa9 My Chat Copyright"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(f,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.14354a96.chunk.js.map